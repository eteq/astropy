<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Support for units and quantities &#8212; Astropy v3.0.dev19489</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0.dev19489',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="custom_model" href="../api/astropy.modeling.custom_model.html" />
    <link rel="prev" title="Algorithms" href="algorithms.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../api/astropy.modeling.custom_model.html" title="custom_model">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="algorithms.html" title="Algorithms">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v3.0.dev19489</a>
	 &#187;
      </li>
      <li><a href="index.html" accesskey="U">Models and Fitting (<code class="docutils literal"><span class="pre">astropy.modeling</span></code>)</a> &#187;</li>
      
      <li>Support for units and quantities</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="support-for-units-and-quantities">
<h1>Support for units and quantities<a class="headerlink" href="#support-for-units-and-quantities" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The functionality presented here was recently added. If you run into
any issues, please don&#8217;t hesitate to open an issue in the <a class="reference external" href="https://github.com/astropy/astropy/issues">issue
tracker</a>.</p>
</div>
<p>The <a class="reference internal" href="index.html#module-astropy.modeling" title="astropy.modeling"><code class="xref py py-obj docutils literal"><span class="pre">astropy.modeling</span></code></a> package includes partial support for the use of units and
quantities in model parameters, models, and during fitting. At this time, only
some of the built-in models (such as
<a class="reference internal" href="../api/astropy.modeling.functional_models.Gaussian1D.html#astropy.modeling.functional_models.Gaussian1D" title="astropy.modeling.functional_models.Gaussian1D"><code class="xref py py-class docutils literal"><span class="pre">Gaussian1D</span></code></a>) support units, but this
will be extended in future to all models where this is appropriate.</p>
<div class="section" id="setting-parameters-to-quantities">
<h2>Setting parameters to quantities<a class="headerlink" href="#setting-parameters-to-quantities" title="Permalink to this headline">¶</a></h2>
<p>Models can take <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-class docutils literal"><span class="pre">Quantity</span></code></a> objects as parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="k">import</span> <span class="n">Gaussian1D</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">)</span>
</pre></div>
</div>
<p>Accessing the parameter then returns a Parameter object that contains the value
and the unit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span>
<span class="go">Parameter(&#39;mean&#39;, value=3.0, unit=m)</span>
</pre></div>
</div>
<p>It is then possible to access the individual properties of the parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;mean&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">value</span>
<span class="go">3.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">unit</span>
<span class="go">Unit(&quot;m&quot;)</span>
</pre></div>
</div>
<p>If a parameter has been initialized as a Quantity, it should always be set to a
quantity, but the units don&#8217;t have to be compatible with the initial ones:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span>
<span class="go">&lt;Gaussian1D(amplitude=3.0 Jy, mean=3.0 s, stddev=2.0 cm)&gt;</span>
</pre></div>
</div>
<p>To change the value of a parameter and not the unit, simply set the value
property:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span>
<span class="go">&lt;Gaussian1D(amplitude=3.0 Jy, mean=2.0 s, stddev=2.0 cm)&gt;</span>
</pre></div>
</div>
<p>Setting a parameter which was originally set to a quantity to a scalar doesn&#8217;t
work because it&#8217;s ambiguous whether the user means to change just the value and
preserve the unit, or get rid of the unit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mi">2</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnitsError </span>: <span class="n">The &#39;mean&#39; parameter should be given as a Quantity because it</span>
<span class="go">was originally initialized as a Quantity</span>
</pre></div>
</div>
<p>On the other hand, if a parameter previously defined without units is given a
Quantity with a unit, this works because it is unambiguous:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span>
</pre></div>
</div>
<p>In other words, once units are attached to a parameter, they can&#8217;t be removed
due to ambiguous meaning.</p>
</div>
<div class="section" id="evaluating-models-with-quantities">
<h2>Evaluating models with quantities<a class="headerlink" href="#evaluating-models-with-quantities" title="Permalink to this headline">¶</a></h2>
<p>Quantities can be passed to model during evaluation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g3</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g3</span><span class="p">(</span><span class="mf">2.9</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>  
<span class="go">&lt;Quantity 0.1353352832366122&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g3</span><span class="p">(</span><span class="mf">2.9</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnitsError </span>: <span class="n">Units of input &#39;x&#39;, s (time), could not be converted to</span>
<span class="go">required input units of m (length)</span>
</pre></div>
</div>
<p>In this case, since the mean and standard deviation have units, the value passed
during evaluation also needs units:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnitsError </span>: <span class="n">Units of input &#39;x&#39;, (dimensionless), could not be converted to</span>
<span class="go">required input units of m (length)</span>
</pre></div>
</div>
</div>
<div class="section" id="equivalencies">
<h2>Equivalencies<a class="headerlink" href="#equivalencies" title="Permalink to this headline">¶</a></h2>
<p>Equivalencies require special care - a Gaussian defined in frequency space is
not a Gaussian in wavelength space for example. For this reason, we don&#8217;t allow
equivalencies to be attached to the parameters themselves. Instead, we take the
approach of converting the input data to the parameter space, and any
equivalencies should be applied at evaluation time to the data (not the
parameters).</p>
<p>Let&#8217;s consider a model that is Gaussian in wavelength space:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span> <span class="o">=</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, passing a frequency will not work:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span><span class="p">(</span><span class="mi">1</span><span class="n">e2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span><span class="p">)</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">UnitsError </span>: <span class="n">Units of input &#39;x&#39;, THz (frequency), could not be converted to</span>
<span class="go">required input units of micron (length)</span>
</pre></div>
</div>
<p>But you can pass a dictionary of equivalencies to the equivalencies argument
(this needs to be a dictionary since some models can contain multiple inputs):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span><span class="p">(</span><span class="mi">110</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()})</span>  
<span class="go">&lt;Quantity 2.888986819525229 Jy&gt;</span>
</pre></div>
</div>
<p>The key of the dictionary should be the name of the inputs according to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span><span class="o">.</span><span class="n">inputs</span>
<span class="go">(&#39;x&#39;,)</span>
</pre></div>
</div>
<p>It is also possible to set default equivalencies for the input parameters using
the input_units_equivalencies property:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span><span class="o">.</span><span class="n">input_units_equivalencies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g4</span><span class="p">(</span><span class="mi">110</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span><span class="p">)</span>  
<span class="go">&lt;Quantity 2.888986819525229 Jy&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="fitting-models-with-units-to-data">
<h2>Fitting models with units to data<a class="headerlink" href="#fitting-models-with-units-to-data" title="Permalink to this headline">¶</a></h2>
<p>Fitting models with units to data with units should be seamless provided that
the model supports fitting with units. To demonstate this, we start off by
generating synthetic data:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">200</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">nm</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mJy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux density (mJy)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../modeling/units-1.png">png</a>, <a class="reference external" href="../modeling/units-1.svg">svg</a>, <a class="reference external" href="../modeling/units-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/units-1.png" src="../_images/units-1.png" />
</div>
<p>and we then define the initial guess for the fitting and we carry out the fit as
we would without any units:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fitting</span>

<span class="n">g5</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">)</span>

<span class="n">fitter</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">LevMarLSQFitter</span><span class="p">()</span>

<span class="n">g5_fit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">g5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g5_fit</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux density (mJy)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../modeling/units-2.png">png</a>, <a class="reference external" href="../modeling/units-2.svg">svg</a>, <a class="reference external" href="../modeling/units-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/units-2.png" src="../_images/units-2.png" />
</div>
</div>
<div class="section" id="fitting-with-equivalencies">
<h2>Fitting with equivalencies<a class="headerlink" href="#fitting-with-equivalencies" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s now consider the case where the data is not equivalent to those of the
parameters, but they are convertible via equivalencies. In this case, the
equivalencies can either be passed via a dictionary as shown higher up for the
evaluation examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">g6</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">110</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">THz</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">)</span>

<span class="n">g6_fit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">g6</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g6_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()}),</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux density (mJy)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../modeling/units-3.png">png</a>, <a class="reference external" href="../modeling/units-3.svg">svg</a>, <a class="reference external" href="../modeling/units-3.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/units-3.png" src="../_images/units-3.png" />
</div>
<p>In this case, the fit (in blue) is slightly worse, because a Gaussian in
frequency space (blue) is not a Gaussian in wavelength space (red). As mentioned
previously, you can also set input_units_equivalencies on the model itself to
avoid having to pass extra arguments to the fitter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">g6</span><span class="o">.</span><span class="n">input_units_equivalencies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()}</span>
<span class="n">g6_fit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">g6</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-support-for-units-in-a-model-advanced">
<h2>Adding support for units in a model (Advanced)<a class="headerlink" href="#adding-support-for-units-in-a-model-advanced" title="Permalink to this headline">¶</a></h2>
<div class="section" id="evaluation">
<h3>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h3>
<p>To make it so that your models can accept parameters with units and be evaluated
using inputs with units, you need to make sure that the
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.evaluate" title="astropy.modeling.Model.evaluate"><code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code></a> method works correctly with
input values and parameters with units. For simple arithmetic, this may work
out of the box since <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-class docutils literal"><span class="pre">Quantity</span></code></a> objects are understood by
a number of Numpy functions.</p>
<p>If users of your models provide input during evaluation that is not compatible
with the parameter units, they may get cryptic errors such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">UnitsError</span> <span class="p">:</span> <span class="n">Can</span> <span class="n">only</span> <span class="n">apply</span> <span class="s1">&#39;subtract&#39;</span> <span class="n">function</span> <span class="n">to</span> <span class="n">dimensionless</span> <span class="n">quantities</span>
<span class="n">when</span> <span class="n">other</span> <span class="n">argument</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">quantity</span> <span class="p">(</span><span class="n">unless</span> <span class="n">the</span> <span class="n">latter</span> <span class="ow">is</span> <span class="nb">all</span>
<span class="n">zero</span><span class="o">/</span><span class="n">infinity</span><span class="o">/</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
<p>There are several attributes or properties that can be set on models that adjust
the behavior of models with units. These attributes can be changed from the
defaults in the class definition, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">input_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">}</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that these are all optional.</p>
<div class="section" id="input-units">
<h4><code class="docutils literal"><span class="pre">input_units</span></code><a class="headerlink" href="#input-units" title="Permalink to this headline">¶</a></h4>
<p>You can easily add checking of the input units by adding an <code class="docutils literal"><span class="pre">input_units</span></code>
property or attribute on your model class. This should return either <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><code class="xref py py-obj docutils literal"><span class="pre">None</span></code></a> (to
indicate no constraints) or a dictionary where the keys are the input names
(e.g. <code class="docutils literal"><span class="pre">x</span></code> for many 1D models) and the values are the units expected, which can
be a function of the parameter units:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">input_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>
</pre></div>
</div>
<p>If the user then gives values with incorrect input units, a clear error will be
displayed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">UnitsError</span><span class="p">:</span> <span class="n">Units</span> <span class="n">of</span> <span class="nb">input</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dimensionless</span><span class="p">),</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">converted</span> <span class="n">to</span>
<span class="n">required</span> <span class="nb">input</span> <span class="n">units</span> <span class="n">of</span> <span class="n">m</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the input units don&#8217;t have to match exactly those returned by
<code class="docutils literal"><span class="pre">input_units</span></code>, but be convertible to them. In addition, <code class="docutils literal"><span class="pre">input_units</span></code> can
also be specified as an attribute rather than a property in simple cases:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">input_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="return-units">
<h4><code class="docutils literal"><span class="pre">return_units</span></code><a class="headerlink" href="#return-units" title="Permalink to this headline">¶</a></h4>
<p>Similarly to <code class="docutils literal"><span class="pre">return_units</span></code>, this should be dictionary that maps the return
values of a model to units. If <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.evaluate" title="astropy.modeling.Model.evaluate"><code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code></a> was called
with quantities but returns unitless values, the units are added to the output.
If the return values are quantities in different units, they are converted to
<code class="docutils literal"><span class="pre">return_units</span></code>.</p>
</div>
<div class="section" id="input-units-strict">
<h4><code class="docutils literal"><span class="pre">input_units_strict</span></code><a class="headerlink" href="#input-units-strict" title="Permalink to this headline">¶</a></h4>
<p>If set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal"><span class="pre">True</span></code></a>, values that are passed in compatible units will be converted
to the exact units specified in <code class="docutils literal"><span class="pre">input_units</span></code>.</p>
</div>
<div class="section" id="input-units-equivalencies">
<h4><code class="docutils literal"><span class="pre">input_units_equivalencies</span></code><a class="headerlink" href="#input-units-equivalencies" title="Permalink to this headline">¶</a></h4>
<p>This can be set to a dictionary that maps the input names to a list of
equivalencies, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">input_units_equivalencies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<div class="section" id="input-units-allow-dimensionless">
<h4><code class="docutils literal"><span class="pre">input_units_allow_dimensionless</span></code><a class="headerlink" href="#input-units-allow-dimensionless" title="Permalink to this headline">¶</a></h4>
<p>If set to <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-obj docutils literal"><span class="pre">True</span></code></a>, values that are plain scalars or Numpy arrays can be passed
to evaluate even if <code class="docutils literal"><span class="pre">input_units</span></code> specifies that the input should have units.
It is up to the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.evaluate" title="astropy.modeling.Model.evaluate"><code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code></a> to then decide how to
handle these dimensionless values.</p>
</div>
</div>
<div class="section" id="fitting">
<h3>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h3>
<p>To allow models with parameters that have units to be fit to data with units,
you will need to add a method called <code class="docutils literal"><span class="pre">_parameter_units_for_data_units</span></code> to your
model class. This should take two arguments <code class="docutils literal"><span class="pre">input_units</span></code> and
<code class="docutils literal"><span class="pre">output_units</span></code> - <code class="docutils literal"><span class="pre">input_units</span></code> will be set to a dictionary with
the units of the independent variables in the data, while <code class="docutils literal"><span class="pre">output_units</span></code> will
be set to a dictionary with the units the dependent variables in the data (for
example, for a simple 1D model, <code class="docutils literal"><span class="pre">input_units</span></code> will have one key, <code class="docutils literal"><span class="pre">x</span></code>, and
<code class="docutils literal"><span class="pre">output_units</span></code> will have one key, <code class="docutils literal"><span class="pre">y</span></code>). This method should then return
a dictionary giving for each parameter the units the parameter should be
converted to so that the model could be used on the data if units were removed
from both the models and the data. The following example shows the
implementation for the 1D Gaussian:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_parameter_units_for_data_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s1">&#39;stddev&#39;</span><span class="p">,</span> <span class="n">inputs_unit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span>
                        <span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="n">outputs_unit</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])])</span>
</pre></div>
</div>
<p>With this method in place, the model can then be fit to data that has units.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Support for units and quantities</a><ul>
<li><a class="reference internal" href="#setting-parameters-to-quantities">Setting parameters to quantities</a></li>
<li><a class="reference internal" href="#evaluating-models-with-quantities">Evaluating models with quantities</a></li>
<li><a class="reference internal" href="#equivalencies">Equivalencies</a></li>
<li><a class="reference internal" href="#fitting-models-with-units-to-data">Fitting models with units to data</a></li>
<li><a class="reference internal" href="#fitting-with-equivalencies">Fitting with equivalencies</a></li>
<li><a class="reference internal" href="#adding-support-for-units-in-a-model-advanced">Adding support for units in a model (Advanced)</a><ul>
<li><a class="reference internal" href="#evaluation">Evaluation</a><ul>
<li><a class="reference internal" href="#input-units"><code class="docutils literal"><span class="pre">input_units</span></code></a></li>
<li><a class="reference internal" href="#return-units"><code class="docutils literal"><span class="pre">return_units</span></code></a></li>
<li><a class="reference internal" href="#input-units-strict"><code class="docutils literal"><span class="pre">input_units_strict</span></code></a></li>
<li><a class="reference internal" href="#input-units-equivalencies"><code class="docutils literal"><span class="pre">input_units_equivalencies</span></code></a></li>
<li><a class="reference internal" href="#input-units-allow-dimensionless"><code class="docutils literal"><span class="pre">input_units_allow_dimensionless</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#fitting">Fitting</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/modeling/units.rst">Edit This Page on Github</a> &nbsp;
    <a href="../_sources/modeling/units.rst.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.6. &nbsp;
    Last built 05 Jul 2017. <br/>
  </p>
</footer>
  </body>
</html>